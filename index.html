<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <title>Hello, world!</title>
</head>
<style>
    * {
        /* color: #fff; */
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    body {
        background-color: #FAFAFA;
       
    }

    a {
        text-decoration: none;
        color: grey;
    }

    .headshot {
        max-width: 50px;
    }

    .theme-btn {
        background-color: #D1701F;
        color: white;
    }

    .theme-btn:hover {
        background-color: #A3622B;
        color: white;

    }

    .table-striped>tbody>tr:nth-of-type(odd) {
        --bs-table-accent-bg: #F0EEFE;
        color: var(--bs-table-striped-color);
    }
</style>

<body>
    <div class="container-fluid mt-3 body">
        <div class="row">
            <div class="col-12 mb-3">
                <div class="row align-items-center justify-content-end">
                    <div class="col-md-6 mb-2">
                        <div class="form-group">
                            <label for=""><b>Home Address</b></label>
                            <input type="text" name="" id="address-input" class="form-control"
                                placeholder="Enter Home Address" aria-describedby="helpId">
                            <div class="text-center">
                                <small id="helpId" class="text-muted">Enter your home or voting registration address and
                                    find your elected representatives' contact information.</small>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="button" id="findBtn" class="btn  theme-btn btn-block">Find
                            Representatives</button>
                    </div>
                </div>
            </div>
            <div class="col-12 " id="outputDiv">

                <div class="row justify-content-center align-items-center">
                    <!-- <div class="col-md-3"></div> -->
                    <div class="col-md-5">
                        <p>
                            Presented here is a valuable tool that empowers you to easily look up your elected
                            representatives across the United States. Simply enter your address, and we will promptly
                            identify who represent you in the government.</p>

                        <p> Being well-informed about these representatives and directly engaging with their offices
                            offers the most effective means of influencing how our government functions.</p>

                        <p>Feel strongly about a particular matter? <b>Discover your rep and make your voice heard!</b>
                        </p>
                    </div>
                    <div class="col-md-4 text-center">
                        <img src="images/usa-r.png" alt="" height="300px" width="95%">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="contactModalTitle"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid" id="modalContent"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="lib/jquery.address.js"></script>
    <script>
        function initAutocomplete() {
            const input = document.getElementById('address-input');
            const options = {
                types: ['geocode'], // Restrict results to geographical locations.
            };
            const autocomplete = new google.maps.places.Autocomplete(input, options);

            // Optional: Add an event listener to get the selected address details.
            autocomplete.addListener('place_changed', function () {
                const place = autocomplete.getPlace();
                if (!place.geometry) {
                    console.log('No location data for this place.');
                    return;
                }
                console.log('Selected place details:');
                console.log('Name:', place.name);
                console.log('Formatted Address:', place.formatted_address);
                console.log('Latitude:', place.geometry.location.lat());
                console.log('Longitude:', place.geometry.location.lng());
            });
        }
    </script>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVat6RaDXoL0EJKdasQfFDG00xoP-lBkE&libraries=places&callback=initAutocomplete"></script>

    <script>
        function isMobileDevice() {
            var check = false;
            (function (a) { if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        var INFO_API = 'https://www.googleapis.com/civicinfo/v2/representatives';
        var social_icon_lookup = {
            'YouTube': 'youtube',
            'Facebook': 'facebook',
            'Twitter': 'twitter',
            'GooglePlus': 'google-plus'
        };
        var federal_pattern = "ocd-division/country:us";
        var state_pattern = /ocd-division\/country:us\/state:(\D{2}$)/;
        var cd_pattern = /ocd-division\/country:us\/state:(\D{2})\/cd:/;
        var sl_pattern = /ocd-division\/country:us\/state:(\D{2})\/(sldl:|sldu:)/;
        var county_pattern = /ocd-division\/country:us\/state:\D{2}\/county:\D+/;
        var local_pattern = /ocd-division\/country:us\/state:\D{2}\/place:\D+/;
        var district_pattern = /ocd-division\/country:us\/district:\D+/;

        var federal_offices = ['United States Senate', 'United States House of Representatives', 'U.S. Senator', 'U.S. Representative'];
        var social_link_lookup = {
            'YouTube': 'https://www.youtube.com/user/',
            'Facebook': 'https://www.facebook.com/',
            'Twitter': 'https://twitter.com/',
            'GooglePlus': 'https://plus.google.com/'
        };
        function checkFederal(division_id, office_name) {
            if (division_id == federal_pattern ||
                cd_pattern.test(division_id) ||
                federal_offices.indexOf(office_name.name) >= 0)
                return true;
            else
                return false;
        }

        function checkState(division_id) {
            if (state_pattern.test(division_id) ||
                sl_pattern.test(division_id))
                return true;
            else
                return false;
        }

        function checkCounty(division_id) {
            if (county_pattern.test(division_id))
                return true;
            else
                return false;
        }

        function formatParty(party) {
            if (party) {
                if (party == 'Unknown')
                    return '';

                var party_letter = party.charAt(0);
                var css_class = 'label-ind';
                if (party_letter == 'D')
                    css_class = 'label-dem';
                else if (party_letter == 'R')
                    css_class = 'label-rep';

                return "(<span title='" + party + "' class='" + css_class + "'>" + party_letter + "</span>)";
            }
            else
                return '';
        }

        function toTitleCase(str) {
            return str.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
        }

        function convertToPlainString(text) {
            if (text === undefined) return '';
            return decodeURIComponent(text);
        }
        var selected_state = '';
        var selected_county = '';
        var selected_local = '';
        var all_people = {};
        var pseudo_id = 1;
        $(document).ready(function () {
            $('#findBtn').on('click', function () {
                var address = $('#address-input').val();
                if (address == '') {
                    return;
                }
                $.address.parameter('address', encodeURIComponent(address));
                var params = {
                    'key': "AIzaSyC9H8OAbV92lNplhiIzfzqDZuPvVUgXeWE",
                    'address': address
                }
                $.when($.getJSON(INFO_API, params)).then(function (data) {

                    console.log(data);
                    var divisions = data['divisions'];
                    var officials = data['officials'];
                    var offices = data['offices'];
                    selected_state = '';
                    selected_county = '';
                    selected_local = '';
                    all_people = {};
                    pseudo_id = 1;
                    var federal_people = [];
                    var state_people = [];
                    var county_people = [];
                    var local_people = [];
                    $.each(divisions, function (division_id, division) {
                        if (typeof division.officeIndices !== 'undefined') {
                            $.each(division.officeIndices, function (i, office) {
                                var office_name = offices[office];
                                $.each(offices[office]['officialIndices'], function (i, official) {
                                    var info = {
                                        'person': null,
                                        'office': office_name,
                                        'address': null,
                                        'channels': null,
                                        'phones': null,
                                        'urls': null,
                                        'emails': null,
                                        'division_id': division_id,
                                        'pseudo_id': pseudo_id
                                    };
                                    var person = officials[official];
                                    info['person'] = person;
                                    if (typeof person.channels !== 'undefined') {
                                        var channels = [];
                                        $.each(person.channels, function (i, channel) {
                                            if (channel.type != 'GooglePlus' && channel.type != 'YouTube') {
                                                channel['icon'] = social_icon_lookup[channel.type];
                                                channel['link'] = social_link_lookup[channel.type] + channel['id'];
                                                channels.push(channel);
                                            }
                                        });
                                        info['channels'] = channels;
                                    }
                                    if (typeof person.address !== 'undefined') {
                                        info['address'] = person.address;
                                    }
                                    if (typeof person.phones !== 'undefined') {
                                        info['phones'] = person.phones;
                                    }
                                    if (typeof person.urls !== 'undefined') {
                                        info['urls'] = person.urls;
                                    }
                                    if (typeof person.emails !== 'undefined') {
                                        info['emails'] = person.emails;
                                    }
                                    if (checkFederal(division_id, office_name)) {
                                        info['jurisdiction'] = 'Federal Government';
                                        console.log(info);
                                        federal_people.push(info);
                                    } else if (checkState(division_id)) {
                                        info['jurisdiction'] = selected_state;
                                        state_people.push(info);
                                    } else if (checkCounty(division_id)) {
                                        info['jurisdiction'] = selected_county;
                                        county_people.push(info);
                                    } else {
                                        info['jurisdiction'] = selected_local;
                                        local_people.push(info);
                                    }
                                    all_people[pseudo_id] = info;
                                    pseudo_id = pseudo_id + 1;

                                });

                            });
                        }
                    });

                    var senators = [];
                    var representatives = [];
                    federal_people.forEach(p => {
                        if (p.office.name != "Vice President of the United States" && p.office.name != "President of the United States") {
                            senators.push(p);
                        }
                    });
                    if (local_people.length > 0) {
                        representatives.push(local_people[0]);
                    }
                    if (county_people.length > 0) {
                        representatives.push(county_people[0]);
                    }
                    if (state_people.length > 0) {
                        for (let i = 0; i < state_people.length; i++) {
                            if (representatives.length < 2) {
                                representatives.push(state_people[i]);
                            }
                        }
                    }
                    console.log(senators);
                    if (!isMobileDevice()) {
                        var tblHtml = '';
                        senators.forEach(c => {
                            var senChannelsHtml = '';
                            if (c.channels || c.urls) {
                                c.channels.forEach(ch => {
                                    senChannelsHtml += `<a href="${ch.link}" class="fa fa-fw fa-${ch.icon}" target="_blank"></a>`;
                                });
                                c.urls.forEach(url => {
                                    senChannelsHtml += `<a href="${url}" class="fa fa-fw fa-globe" target="_blank"></a>`;
                                });
                            }
                            tblHtml += `<tr>
                                <td>
                                    <img src="${(c.person.photoUrl != undefined) ? c.person.photoUrl : 'images/blank-person.jpg'}" class="img-rounded headshot" alt="${c.person.name}">
                                </td>
                                <td>${c.person.name + " " + formatParty(c.person.party)} </td>
                                <td>${(c.office.name != true && c.office.name != false) ? c.office.name : "U.S. Senator"}</td>
                                <td>${(c.address != null) ? c.address[0].line1 + " " + c.address[0].city + ", " + c.address[0].state + " " + c.address[0].zip : ""}</td>
                                <td>
                                    ${senChannelsHtml}
                                </td>
                                <td>
                                    <button type="button" class="btn btn-warning text-white btn-contact" data-target="#contactModal" data-toggle="modal" data-id="${c.pseudo_id}">Contact</button>
                                </td>
                            </tr>`;
                        });

                        $('#outputDiv').html(`<div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Representatives</h4>
                            <div class="table-responsive">
                                <table class="table table-striped" id="repTable">
                                    <thead>
                                        <tr>
                                            <th scope="col" width="5%">
                                            </th>
                                            <th scope="col" width="20%"><b>Representative</b></th>
                                            <th scope="col" width="15%"><b>Office</b></th>
                                            <th scope="col" width="35%"><b>Address</b></th>
                                            <th scope="col" width="15%"><b>Links</b></th>
                                            <th scope="col" width="10%">
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    ${tblHtml}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        </div>`);
                    } else {
                        var tblHtml = '';
                        senators.forEach((c, index) => {
                            var senChannelsHtml = '';
                            if (c.channels || c.urls) {
                                c.channels.forEach(ch => {
                                    senChannelsHtml += `<a href="${ch.link}" class="fa fa-fw fa-${ch.icon}" target="_blank"></a>`;
                                });
                                c.urls.forEach(url => {
                                    senChannelsHtml += `<a href="${url}" class="fa fa-fw fa-globe" target="_blank"></a>`;
                                });
                            }
                            
                            tblHtml += `
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="accordHead${c.pseudo_id}">
                                    <button class="accordion-button ${(index == 0) ? "" : "collapsed"}" type="button" data-bs-toggle="collapse" data-bs-target="#accord${c.pseudo_id}" aria-expanded="${(index == 0) ? "true" : "false"}" aria-controls="">
                                       <b>${c.person.name + " " + formatParty(c.person.party)}</b>
                                    </button>
                                </h2>
                                <div id="accord${c.pseudo_id}" class="accordion-collapse collapse ${(index == 0) ? "show" : ""}" aria-labelledby="accordHead${c.pseudo_id}" data-bs-parent="#accordionExample">
                                    <div class="accordion-body">
                                        <p><img src="${(c.person.photoUrl != undefined) ? c.person.photoUrl : 'images/blank-person.jpg'}" class="img-rounded headshot" alt="${c.person.name}"></p>
                                        <p><span class="text-center me-1"><i class="fa fa-university" aria-hidden="true"></i></span>${c.office.name}</p>
                                        <p><span class="text-center me-1"><i class="fa fa-map-marker" aria-hidden="true"></i></span>${(c.address != null) ? c.address[0].line1 + " " + c.address[0].city + ", " + c.address[0].state + " " + c.address[0].zip : ""}</p>
                                        <p><span class="text-center me-1"><i class="fa fa-external-link"></i></span>${senChannelsHtml}</p>
                                        <p><button type="button" class="btn btn-warning text-white btn-contact" data-target="#contactModal" data-toggle="modal" data-id="${c.pseudo_id}">Contact</button></p>
                                    </div>
                                </div>
                            </div>`;
                        });
                        
                        $('#outputDiv').html(`<div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Representatives</h4>
                            <div class="accordion" id="accordionExample">
                                ${tblHtml}
                            </div>
                        </div>
                        </div>`);
                    }



                }, function (error) {
                    console.error('Error occurred:', error);
                    $('#outputDiv').html(`<div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Representatives</h4>
                        <div class="table-responsive">
                            <table class="table table-striped" id="repTable">
                                <thead>
                                    <tr>
                                        <th scope="col" width="5%">
                                        </th>
                                        <th scope="col" width="20%"><b>Representative</b></th>
                                        <th scope="col" width="15%"><b>Office</b></th>
                                        <th scope="col" width="35%"><b>Address</b></th>
                                        <th scope="col" width="15%"><b>Links</b></th>
                                        <th scope="col" width="10%">
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="6" class="text-center text-muted">No representative found for selected address.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>`);

                });
            });
            $('body').on('click', '.btn-contact', function () {
                var info = all_people[$(this).data('id')];
                var phonesHtml = '';
                var emailsHtml = '';
                $('#contactModalTitle').text("Contact " + info.person.name)
                if (info.phones) {
                    $.each(info.phones, function (i, phone) {
                        if ((i + 1) < info.phones.length) {
                            phonesHtml += `<i class='fa fa-fw fa-phone'></i>${phone}<br>`;
                        } else {
                            phonesHtml += `<i class='fa fa-fw fa-phone'></i>${phone}`;
                        }
                    });
                }
                if (info.emails) {
                    $.each(info.emails, function (i, email) {
                        if ((i + 1) < info.emails.length) {
                            emailsHtml += `<i class='fa fa-fw fa-envelope'></i> <a href='mailto:${email}'>${email}</a><br>`;
                        } else {
                            emailsHtml += `<i class='fa fa-fw fa-envelope'></i> <a href='mailto:${email}'>${email}</a>`;
                        }
                    });
                }
                var modalHtml = `<div class="row">
                    <div class='col-md-5 col-xs-12 '>
                        ${info.person.photoUrl ? '<img class="img-rounded img-fluid" src="' + info.person.photoUrl + '" alt="' + info.person.name + '" title="' + info.person.name + '"  style="max-width: 150px !important;" />' : '<img class="img-rounded img-fluid" src="images/blank-person.jpg" alt="' + info.person.name + '" title="' + info.person.name + '"  style="max-width: 150px !important;" />'}
                    <br />
                    <strong>
                        ${info.person.name}
                        ${formatParty(info.person.party)}
                    </strong><br>
                        ${(info.office.name != true && info.person.name != false) ? info.office.name : 'U.S. Senator'}<br>
                            ${info.jurisdiction}
                        </div>
                        <div class='col-md-7 col-xs-12 '>
                            <p><strong>Contact ${info.person.name}</strong></p>
                            <hr>
                            ${phonesHtml}
                             <br>
                            ${emailsHtml}
                    </div>
                    </div>`;
                $('#modalContent').html(modalHtml);
                $('#contactModal').modal('show');
            })
        });
    </script>

</body>

</html>